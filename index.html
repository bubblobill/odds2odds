<!DOCTYPE html>
<html lang="en-au">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title></title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css" />
</head>
<script>
    function setThemeClass() {
        document.documentElement.className = Telegram.WebApp.colorScheme;
    }
    Telegram.WebApp.onEvent('themeChanged', setThemeClass);
    setThemeClass();
</script>
</head>
<body>
<form id="fm">
<section  class="viewport-container">
        <div class="input-container flex2">
            <div>
                <label class="locale" for="us-odds">
                    <img src="img/us.svg" alt="ðŸ‡ºðŸ‡¸">
                </label>
                <input type="number" class="numberInput" id="us-odds" value="100" step="10">
            </div>
            <div>
                <label class="locale" for="dec-odds">
                    <img src="img/earthGlobe.svg" alt="ðŸŒ">
                </label>
                <input type="number" class="numberInput" id="dec-odds" value="1.00" step="0.1">
            </div>
        </div>
        <div class="button-container flex2">
            <input form="fm" type="reset" id="clear" class="button clear_btn" value="&#x21bb;" />
            <button id="close" class="button close_btn" >&#10006;</button>
        </div>
    </form>
</section>
<script>
    const usOdds = document.getElementById("us-odds");
    const dOdds = document.getElementById("dec-odds");

    window.addEventListener("load", function(){
        usOdds.addEventListener("input", inputHandler);
        dOdds.addEventListener("input", inputHandler);
        document.getElementById("close").addEventListener("click", DemoApp.close);

    });
    function inputHandler(e){
        const t = e.target;
        if(t != document.activeElement){
            return;
        };
        if(t==usOdds){
            if(t.value > -100 && t.value < 100){
                t.value = Math.sign(t.value) * -100;
                return;
            }
            dOdds.value = usToDec(t.value);
            return;
        } else {
            if(t.value == 0){
                return;
            }
            usOdds.value = decToUs(t.value);
        }
    }

    function decToUs(dec){
        if(dec == 2){
            return 100;
        } else if(dec > 2){
            return Math.round((dec - 1) * 100);
        } else {
            return Math.round(-100 / (dec - 1));
        }
    }
    function usToDec(us){
        if(Math.sign(us) == 1){
            return (1+us/100).toFixed(2);
        } else {
            return (1-100/us).toFixed(2);
        }
    }
</script>
<script type="application/javascript">
    /*
     * This is a demo code for Telegram WebApp for Bots
     * It contains basic examples of how to use the API
     * Note: all requests to backend are disabled in this demo, you should use your own backend
     */

    const DemoApp = {
        MainButton    : Telegram.WebApp.MainButton,

        init(options) {
            Telegram.WebApp.ready();
            Telegram.WebApp.MainButton.setParams({
                text      : 'CLOSE WEBVIEW',
                is_visible: true
            }).onClick(DemoApp.close);
            Telegram.WebApp.disableClosingConfirmation();
        },
        expand() {
            Telegram.WebApp.expand();
        },
        close() {
        console.log("close");
            Telegram.WebApp.close();
        },
        toggleMainButton(el) {
            const mainButton = Telegram.WebApp.MainButton;
            if (mainButton.isVisible) {
                mainButton.hide();
                el.innerHTML = 'Show Main Button';
            } else {
                mainButton.show();
                el.innerHTML = 'Hide Main Button';
            }
        },

        // Other
        apiRequest(method, data, onCallback) {
            // DISABLE BACKEND FOR FRONTEND DEMO
            // YOU CAN USE YOUR OWN REQUESTS TO YOUR OWN BACKEND
            // CHANGE THIS CODE TO YOUR OWN
            return onCallback && onCallback({error: 'This function (' + method + ') should send requests to your backend. Please, change this code to your own.'});

            const authData = DemoApp.initData || '';
            fetch('/demo/api', {
                method     : 'POST',
                body       : JSON.stringify(Object.assign(data, {
                    _auth : authData,
                    method: method,
                })),
                credentials: 'include',
                headers    : {
                    'Content-Type': 'application/json'
                }
            }).then(function (response) {
                return response.json();
            }).then(function (result) {
                onCallback && onCallback(result);
            }).catch(function (error) {
                onCallback && onCallback({error: 'Server error'});
            });
        }
    }

    const DemoAppMenu = {
        init() {
            DemoApp.init();
            document.body.classList.add('gray');
            Telegram.WebApp.setHeaderColor('secondary_bg_color');
        }
    };

    const DemoAppInitData = {
        init() {
            DemoApp.init();
            Telegram.WebApp.onEvent('themeChanged', function () {
            });
        }
    };



    function byteLength(str) {
        if (window.Blob) {
            try {
                return new Blob([str]).size;
            } catch (e) {
            }
        }

        let s = str.length;
        for (let i = str.length - 1; i >= 0; i--) {
            const code = str.charCodeAt(i);
            if (code > 0x7f && code <= 0x7ff) {
                s++;
            } else if (code > 0x7ff && code <= 0xffff) {
                s += 2;
            }

            if (code >= 0xDC00 && code <= 0xDFFF) {
                i--;
            }
        }
        return s;
    }

    function round(val, d) {
        const k = Math.pow(10, d || 0);
        return Math.round(val * k) / k;
    }
</script>

<script type="application/javascript">
    /*
     * This part of code is used to initialize the demo app and set up the event handlers we need.
     */

    Telegram.WebApp.onEvent('themeChanged', function () {
        document.body.setAttribute('style', '--bg-color:' + Telegram.WebApp.backgroundColor);
    });


    DemoApp.init();
</script>
</body>
</html>